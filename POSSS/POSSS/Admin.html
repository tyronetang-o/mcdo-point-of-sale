<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .dashboard-container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        .inventory-section {
            flex: 2;
        }
        .orders-section {
            flex: 1;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #item-form {
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 1em;
            margin-top: 1em;
            max-width: 400px;
        }
        #item-form input {
            display: block;
            width: 100%;
            margin-bottom: 0.5em;
            padding: 0.5em;
        }
        #item-form button {
            margin-right: 0.5em;
        }
        .low-stock {
            color: red;
            font-weight: bold;
        }
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .inventory-table th, .inventory-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        .inventory-table th {
            background-color: #f5f5f5;
        }
        .order-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .refresh-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .refresh-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="pos-container">
        <!-- Header -->
        <header class="pos-header">
            <div class="logo">
                <h1>McDonalds Admin Dashboard</h1>
            </div>
            <div class="header-controls">
                <span class="user-info">
                    <i class="fas fa-user"></i> Admin
                </span>
                <button class="btn-secondary" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="pos-main">
            <div class="dashboard-container">
                <!-- Inventory Section -->
                <section class="inventory-section">
                    <div class="products-header">
                        <h2>Inventory Management</h2>
                        <div>
                            <button onclick="openForm()">+ Add Item</button>
                            <button class="refresh-btn" onclick="loadInventory()"><i class="fas fa-sync"></i> Refresh</button>
                        </div>
                    </div>

                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Price (₱)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-body"></tbody>
                    </table>
                </section>

                <!-- Orders Section -->
                <section class="orders-section">
                    <h2>Recent Orders</h2>
                    <div id="orders-list"></div>
                </section>
            </div>

            <!-- Modal Form -->
            <div id="item-form" style="display: none;">
                <h3 id="form-title">Add Item</h3>
                <input type="text" id="item-name" placeholder="Item Name">
                <input type="text" id="item-category" placeholder="Category">
                <input type="number" id="item-quantity" placeholder="Quantity">
                <input type="number" step="0.01" id="item-price" placeholder="Price">
                <button onclick="saveItem()">Save</button>
                <button onclick="closeForm()">Cancel</button>
            </div>
        </main>

        <!-- Footer -->
        <footer class="pos-footer">
            <div class="footer-info">
                <span>Admin: <span id="admin-name"></span></span>
                <span>Date: <span id="current-date"></span></span>
            </div>
        </footer>
    </div>

    <script>
        // Check authentication
        window.onload = function() {
            const currentUser = sessionStorage.getItem('currentUser');
            if (!currentUser || JSON.parse(currentUser).role !== 'admin') {
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('admin-name').textContent = JSON.parse(currentUser).username;
            document.getElementById('current-date').textContent = new Date().toLocaleDateString();
            loadInventory();
            loadOrders();
            // Set up real-time updates
            setInterval(loadInventory, 5000); // Refresh every 5 seconds
            setInterval(loadOrders, 5000);
        }

        function logout() {
            sessionStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // Initialize inventory from localStorage or with default values
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [
            { id: 1, name: 'Burger', category: 'food', quantity: 50, price: 182 },
            { id: 2, name: '1pc Chicken McDo with Rice', category: 'food', quantity: 45, price: 92 },
            { id: 3, name: 'Spaghetti', category: 'food', quantity: 40, price: 122 },
            { id: 4, name: 'Chicken Fillet Ala King', category: 'food', quantity: 35, price: 89 },
            { id: 5, name: 'Fries', category: 'snacks', quantity: 100, price: 109 },
            { id: 6, name: 'Apple Pie', category: 'snacks', quantity: 45, price: 45 },
            { id: 7, name: 'Coke', category: 'beverages', quantity: 200, price: 77 },
            { id: 8, name: 'Coke Mc Float', category: 'beverages', quantity: 80, price: 59 },
            { id: 9, name: 'Vanilla Sundae Cone', category: 'desserts', quantity: 60, price: 20 }
        ];
        
        let editIndex = -1;

        function saveToLocalStorage() {
            localStorage.setItem('inventory', JSON.stringify(inventory));
        }

        function loadInventory() {
            inventory = JSON.parse(localStorage.getItem('inventory')) || inventory;
            const tbody = document.getElementById('inventory-body');
            tbody.innerHTML = '';
            inventory.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = item.quantity < 20 ? 'low-stock' : '';
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.quantity}</td>
                    <td>₱${item.price.toFixed(2)}</td>
                    <td>
                        <button onclick="editItem(${index})">Edit</button>
                        <button onclick="deleteItem(${index})">Delete</button>
                        <button onclick="restockItem(${index})">Restock</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = '';
            
            orders.slice().reverse().forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'order-item';
                orderElement.innerHTML = `
                    <p><strong>Transaction ID:</strong> ${order.transactionId}</p>
                    <p><strong>Staff:</strong> ${order.staff}</p>
                    <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
                    <p><strong>Items:</strong></p>
                    <ul>
                        ${order.items.map(item => `
                            <li>${item.name} x${item.quantity} (₱${(item.price * item.quantity).toFixed(2)})</li>
                        `).join('')}
                    </ul>
                    <p><strong>Total:</strong> ₱${order.total.toFixed(2)}</p>
                `;
                ordersList.appendChild(orderElement);
            });
        }

        function openForm() {
            document.getElementById('item-form').style.display = 'block';
            document.getElementById('form-title').innerText = 'Add Item';
            document.getElementById('item-name').value = '';
            document.getElementById('item-category').value = '';
            document.getElementById('item-quantity').value = '';
            document.getElementById('item-price').value = '';
            editIndex = -1;
        }

        function closeForm() {
            document.getElementById('item-form').style.display = 'none';
        }

        function saveItem() {
            const name = document.getElementById('item-name').value;
            const category = document.getElementById('item-category').value;
            const quantity = parseInt(document.getElementById('item-quantity').value);
            const price = parseFloat(document.getElementById('item-price').value);

            if (editIndex >= 0) {
                inventory[editIndex] = { ...inventory[editIndex], name, category, quantity, price };
            } else {
                const newId = Math.max(...inventory.map(item => item.id), 0) + 1;
                inventory.push({ id: newId, name, category, quantity, price });
            }

            saveToLocalStorage();
            loadInventory();
            closeForm();
        }

        function editItem(index) {
            const item = inventory[index];
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-category').value = item.category;
            document.getElementById('item-quantity').value = item.quantity;
            document.getElementById('item-price').value = item.price;
            document.getElementById('form-title').innerText = 'Edit Item';
            document.getElementById('item-form').style.display = 'block';
            editIndex = index;
        }

        function deleteItem(index) {
            if (confirm('Are you sure you want to delete this item?')) {
                inventory.splice(index, 1);
                saveToLocalStorage();
                loadInventory();
            }
        }

        function restockItem(index) {
            const amount = parseInt(prompt('Enter restock amount:'));
            if (amount && amount > 0) {
                inventory[index].quantity += amount;
                saveToLocalStorage();
                loadInventory();
            }
        }
    </script>
</body>
</html>
